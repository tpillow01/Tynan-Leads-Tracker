{% extends "base.html" %}
{% block title %}{{ rep_name }} — Leads{% endblock %}

{% block content %}
<section class="page-header">
  <h2>{{ rep_name }} — Leads</h2>
  <div class="actions">
    <a class="btn secondary" href="{{ url_for('kanban_view') }}">Back to Dashboard</a>
  </div>
</section>

<form method="get" action="{{ url_for('rep_page', slug=rep_name|lower|replace(' ','-')) }}" class="card filter" style="margin-bottom:10px;">
  <div class="form-grid">
    <div class="form-field">
      <label for="q">Search</label>
      <input id="q" name="q" type="text" value="{{ q or '' }}" placeholder="Search company, notes, city, source">
    </div>
    <div class="form-field">
      <label for="quality">Quality</label>
      <select id="quality" name="quality">
        <option value="" {% if (quality_filter or '')=='' %}selected{% endif %}>All</option>
        <option value="good" {% if quality_filter=='good' %}selected{% endif %}>Good</option>
        <option value="warm" {% if quality_filter=='warm' %}selected{% endif %}>Warm</option>
        <option value="bad"  {% if quality_filter=='bad' %}selected{% endif %}>Bad</option>
        <option value="unknown" {% if quality_filter=='unknown' %}selected{% endif %}>Unknown</option>
      </select>
    </div>
  </div>
  <div class="form-actions">
    <button class="btn" type="submit">Apply</button>
    <a class="btn secondary" href="{{ url_for('rep_page', slug=rep_name|lower|replace(' ','-')) }}">Clear</a>
  </div>
</form>

<div class="table-wrap">
  <table class="data-table">
    <thead>
      <tr>
        <th>Company</th>
        <th>Date</th>
        <th>City</th>
        <th>Source</th>
        <th>Quality</th>
        <th class="right">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for l in leads %}
      <tr>
        <td>{{ l.company or '—' }}</td>
        <td>{{ (l.lead_date.strftime('%Y-%m-%d') if l.lead_date else '—') }}</td>
        <td>{{ l.city or '—' }}</td>
        <td>{{ l.source or '—' }}</td>
        {% set q = (l.quality or 'unknown') %}
        <td><span class="badge {{ q }}">{{ q.title() }}</span></td>
        <td class="right"><a class="btn small" href="{{ url_for('lead_detail', lead_id=l.id) }}">View</a></td>
      </tr>
      {% endfor %}
      {% if not leads %}
      <tr><td colspan="6"><div class="empty-state">No leads for this rep.</div></td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
